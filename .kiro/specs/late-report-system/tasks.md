# 實作計劃

- [x] 1. 建立統計分析模組
  - 實作統計資料查詢和計算邏輯
  - 建立統計 API 端點，支援每日、週報、月報查詢
  - 實作統計快取機制，提升查詢效能
  - _需求: 4.5_

- [x] 1.1 實作統計資料查詢函數
  - 在 `src/database/index.ts` 中新增統計查詢方法
  - 實作 `getLateReportStats()` 函數，支援不同時間範圍查詢
  - 建立統計資料結構和型別定義
  - _需求: 4.5_

- [x] 1.2 建立統計快取表和機制
  - 建立資料庫遷移檔案，新增 `stats_cache` 表格
  - 實作快取讀寫邏輯，避免重複計算
  - 設定快取過期機制，確保資料即時性
  - _需求: 4.5_

- [x] 1.3 實作統計 API 端點
  - 在 `src/bot/index.ts` 中新增統計相關路由
  - 實作 `/api/stats/late-reports/*` 端點
  - 加入權限檢查，確保只有管理員可存取
  - _需求: 4.3, 4.4, 4.5_

- [ ] 2. 擴展管理員查詢功能
  - 增強現有的 `/late_reports` 指令功能
  - 新增個人統計查詢指令
  - 實作週報、月報自動產生功能
  - _需求: 4.4, 4.5_

- [ ] 2.1 增強遲到回報查詢指令
  - 修改 `src/modules/lateReport.ts` 中的 `/late_reports` 指令
  - 新增日期範圍篩選功能
  - 新增按用戶、群組篩選功能
  - _需求: 4.4_

- [ ] 2.2 實作個人統計查詢功能
  - 新增 `/my_late_stats` 指令，讓用戶查看個人統計
  - 實作 `/user_late_stats` 指令，讓管理員查看特定用戶統計
  - 加入統計圖表文字化顯示
  - _需求: 4.4, 6.1_

- [ ] 2.3 建立自動報告生成功能
  - 實作週報、月報自動生成邏輯
  - 建立報告模板和格式化函數
  - 設定定時觸發機制（透過 Cron Triggers）
  - _需求: 4.5_

- [ ] 3. 配置前端 Cloudflare Workers 部署
  - 修改前端建置配置，支援 Workers 部署
  - 建立前端 Worker 入口檔案
  - 配置路由分離策略
  - _需求: 7.2, 7.5, 7.8_

- [ ] 3.1 建立前端 Worker 入口檔案
  - 在 `frontend/src/` 中建立 `worker.ts` 檔案
  - 實作靜態檔案服務邏輯
  - 設定 SPA 路由處理機制
  - _需求: 7.2_

- [ ] 3.2 修改前端建置配置
  - 更新 `frontend/vite.config.ts`，支援 Worker 建置
  - 修改 `frontend/package.json` 建置腳本
  - 設定環境變數處理機制
  - _需求: 7.2, 7.6_

- [ ] 3.3 配置前後端路由整合
  - 修改後端路由，支援前端靜態檔案服務
  - 實作路徑分離邏輯（/api/* vs /*）
  - 設定 CORS 和安全標頭
  - _需求: 7.5, 7.8_

- [ ] 4. 建立前端管理面板統計頁面
  - 實作統計資料顯示元件
  - 建立圖表和視覺化功能
  - 整合後端統計 API
  - _需求: 4.5_

- [ ] 4.1 建立統計資料顯示元件
  - 在 `frontend/src/components/` 中建立統計相關元件
  - 實作資料表格和卡片顯示
  - 建立載入狀態和錯誤處理
  - _需求: 4.5_

- [ ] 4.2 實作統計頁面路由和視圖
  - 在 `frontend/src/views/` 中建立 `Statistics.vue`
  - 整合統計元件和 API 呼叫
  - 實作篩選和搜尋功能
  - _需求: 4.5_

- [ ] 4.3 建立前端 API 服務層
  - 在 `frontend/src/services/` 中建立 API 呼叫函數
  - 實作錯誤處理和重試機制
  - 設定 API 基礎 URL 和認證
  - _需求: 7.5_

- [ ] 5. 實作系統設定管理功能
  - 建立設定管理 API 端點
  - 實作前端設定管理頁面
  - 加入設定變更日誌記錄
  - _需求: 5.1, 5.2, 5.3, 5.5_

- [ ] 5.1 建立設定管理 API
  - 在後端新增 `/api/settings/*` 端點
  - 實作設定讀取、更新、刪除功能
  - 加入超級管理員權限檢查
  - _需求: 5.1, 5.2, 5.3_

- [ ] 5.2 實作前端設定管理頁面
  - 建立 `frontend/src/views/Settings.vue`
  - 實作設定項目的 CRUD 操作介面
  - 加入設定驗證和即時預覽功能
  - _需求: 5.1, 5.2, 5.3_

- [ ] 5.3 實作設定變更日誌功能
  - 修改設定更新邏輯，自動記錄變更日誌
  - 在前端顯示設定變更歷史
  - 實作設定回滾功能
  - _需求: 5.5_

- [ ] 6. 建立資料庫遷移和部署腳本
  - 建立統計相關的資料庫遷移檔案
  - 更新部署腳本，支援前後端同時部署
  - 實作環境變數管理和驗證
  - _需求: 7.3, 7.6, 7.7_

- [ ] 6.1 建立統計功能資料庫遷移
  - 建立 `migrations/0002_add_stats_cache.sql`
  - 新增統計快取表格和索引
  - 插入統計相關的預設設定
  - _需求: 7.3, 7.7_

- [ ] 6.2 更新部署配置和腳本
  - 修改 `wrangler.toml`，支援前端 Worker 配置
  - 建立部署腳本，自動執行遷移和建置
  - 設定環境變數模板和驗證
  - _需求: 7.6, 7.7_

- [ ] 6.3 實作部署前檢查和測試
  - 建立部署前的系統檢查腳本
  - 實作 API 端點健康檢查
  - 設定自動化測試和驗證流程
  - _需求: 7.1, 7.4_

- [ ] 7. 系統整合測試和優化
  - 執行完整的端對端測試
  - 優化 API 回應時間和資料庫查詢
  - 驗證前後端在正式環境的整合
  - _需求: 7.1, 7.2, 7.4, 7.5_

- [ ] 7.1 執行端對端整合測試
  - 測試完整的遲到回報流程
  - 驗證統計功能的準確性
  - 測試前端管理面板的所有功能
  - _需求: 7.4, 7.5_

- [ ] 7.2 效能優化和監控設定
  - 優化統計查詢的資料庫索引
  - 實作 API 回應時間監控
  - 設定錯誤追蹤和日誌分析
  - _需求: 7.1, 7.4_

- [ ] 7.3 正式環境部署和驗證
  - 部署到 Cloudflare Workers 正式環境
  - 驗證 Webhook 和 API 端點正常運作
  - 執行使用者驗收測試
  - _需求: 7.1, 7.2, 7.4, 7.5_