# 需求文件

## 簡介

智能遲到回報系統是 YUI Telegram Bot 的核心功能之一，旨在自動識別員工在群組中的遲到通知，並進行智能化處理和記錄。系統需要支援台北時間判斷、關鍵字識別、互動式原因選擇，以及管理員自動通知功能。

## 需求

### 需求 1

**用戶故事:** 身為一名員工，我希望能在群組中自然地表達遲到情況，讓系統自動識別並記錄，這樣我就不需要填寫複雜的表單。

#### 驗收標準

1. 當員工在群組中發送包含遲到關鍵字的訊息時，系統應該自動識別並觸發遲到回報流程
2. 如果訊息包含「遲到」、「晚到」、「晚點到」、「會遲到」、「會晚到」等關鍵字，系統應該立即回應
3. 當訊息包含「塞車」、「交通」、「路況」、「臨時」、「突然」、「緊急」等相關詞彙時，系統應該詢問是否為遲到回報
4. 系統應該忽略非遲到相關的一般對話

### 需求 2

**用戶故事:** 身為一名員工，我希望系統能根據台北時間自動判斷我的通知是否及時，這樣管理層就能了解我是否有提前告知。

#### 驗收標準

1. 當員工在台北時間 09:00 之前發送遲到通知時，系統應該標記為「及時通知」
2. 當員工在台北時間 09:00 之後發送遲到通知時，系統應該標記為「逾時通知」
3. 系統應該正確處理跨日期的時間計算
4. 系統應該在記錄中保存確切的通知時間

### 需求 3

**用戶故事:** 身為一名員工，我希望能透過簡單的按鈕選擇遲到原因，或者輸入自訂原因，這樣就能快速完成回報流程。

#### 驗收標準

1. 當系統識別到遲到訊息時，應該顯示常見原因的按鈕選單
2. 常見原因應該包括：「交通狀況」、「身體不適」、「家庭事務」、「工作延誤」、「其他」
3. 當用戶選擇「其他」時，系統應該提示用戶輸入自訂原因
4. 用戶應該能夠在 30 秒內取消回報流程
5. 系統應該在用戶完成選擇後確認回報已記錄

### 需求 4

**用戶故事:** 身為一名管理員，我希望能自動收到員工的遲到通知，並查看詳細的回報記錄，這樣我就能及時了解團隊狀況。

#### 驗收標準

1. 當員工完成遲到回報時，系統應該自動通知所有具有管理員權限的用戶
2. 通知訊息應該包含：員工姓名、通知時間、是否及時、遲到原因
3. 管理員應該能夠透過指令查看當日所有遲到回報
4. 管理員應該能夠查看特定員工的遲到歷史記錄
5. 系統應該提供遲到統計功能（週報、月報）

### 需求 5

**用戶故事:** 身為一名系統管理員，我希望能夠設定遲到回報系統的參數，這樣就能根據公司政策調整系統行為。

#### 驗收標準

1. 超級管理員應該能夠修改遲到判定的截止時間（預設 09:00）
2. 超級管理員應該能夠新增或修改遲到關鍵字清單
3. 超級管理員應該能夠自訂常見遲到原因選項
4. 超級管理員應該能夠啟用或停用特定群組的遲到回報功能
5. 系統應該記錄所有設定變更的操作日誌

### 需求 6

**用戶故事:** 身為一名員工，我希望系統能夠保護我的隱私，確保遲到記錄只有授權人員能夠查看。

#### 驗收標準

1. 一般用戶只能查看自己的遲到記錄
2. 管理員只能查看其管理群組內的遲到記錄
3. 超級管理員可以查看所有遲到記錄
4. 系統應該記錄所有查看遲到記錄的操作日誌
5. 敏感資料應該在資料庫中加密存儲

### 需求 7

**用戶故事:** 身為一名系統維護人員，我希望遲到回報系統能夠穩定運行在雲端環境中，並且前後端都能順利部署到 Cloudflare Workers 正式環境。

#### 驗收標準

1. 後端 Bot 系統應該能夠成功部署到 Cloudflare Workers 正式環境
2. 前端管理面板應該能夠建置並部署到 Cloudflare Workers 正式環境
3. 前後端系統應該在正式環境中正確連接共享的 D1 資料庫和 KV 快取
4. 部署後的後端系統應該能夠處理 Telegram Webhook 請求
5. 部署後的前端系統應該能夠正確呼叫後端 API 端點
6. 系統應該支援開發環境和正式環境的環境變數分離
7. 部署流程應該包含資料庫遷移的自動執行
8. 前後端 Workers 應該能夠透過適當的路由配置共存於同一網域或不同子網域